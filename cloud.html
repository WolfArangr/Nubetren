<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Nube vs Tren - Giroscopio</title>
<style>
  body {
    margin: 0;
    background: #87ceeb;
    font-family: sans-serif;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    user-select: none;
  }
  #game {
    position: relative;
    width: 360px;
    height: 600px;
    background: #ccefff;
    border: 2px solid #333;
    overflow: hidden;
    margin-top: 20px;
  }
  #cloud {
    position: absolute;
    bottom: 20px;
    left: 50%;
    font-size: 48px;
    transform: translateX(-50%);
    transition: font-size 0.2s;
  }
  .food {
    position: absolute;
    font-size: 32px;
    user-select: none;
  }
  #train {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 48px;
    user-select: none;
    display: none;
  }
  #info {
    margin-top: 10px;
    font-weight: bold;
    font-size: 18px;
  }
  #fallback {
    margin-top: 10px;
    font-size: 14px;
    color: #333;
  }
</style>
</head>
<body>

<div id="game">
  <div id="cloud">‚òÅÔ∏è</div>
  <div id="train">üöÇ</div>
</div>
<div id="info">Comidas recolectadas: 0</div>
<div id="fallback">Inclina el m√≥vil para mover la nube (o usa ‚Üê ‚Üí)</div>

<script>
(() => {
  const game = document.getElementById('game');
  const cloud = document.getElementById('cloud');
  const train = document.getElementById('train');
  const info = document.getElementById('info');

  const gameWidth = game.clientWidth;
  const gameHeight = game.clientHeight;

  // Estado nube
  let cloudX = gameWidth / 2;
  let cloudSize = 48;
  const cloudBaseSize = 48;
  const cloudMaxSize = 120;

  // Comida
  const foodEmojis = ['üçü','üçî','üçï','üç∞','üç©','üåΩ'];
  let foods = [];

  // Contador
  let foodCount = 0;

  // Juego activo
  let gameActive = true;

  // Variables para movimiento
  let tiltX = 0;

  // Crear comida
  function createFood() {
    const emoji = foodEmojis[Math.floor(Math.random() * foodEmojis.length)];
    const x = Math.random() * (gameWidth - 32);
    const y = -32;
    const el = document.createElement('div');
    el.classList.add('food');
    el.textContent = emoji;
    el.style.left = x + 'px';
    el.style.top = y + 'px';
    game.appendChild(el);
    foods.push({el, x, y, speed: 2 + Math.random() * 2});
  }

  // Mover comida hacia abajo
  function moveFoods() {
    for (let i = foods.length - 1; i >= 0; i--) {
      let f = foods[i];
      f.y += f.speed;
      if (f.y > gameHeight) {
        game.removeChild(f.el);
        foods.splice(i,1);
        continue;
      }
      f.el.style.top = f.y + 'px';

      // Colisi√≥n con nube
      const foodRect = f.el.getBoundingClientRect();
      const cloudRect = cloud.getBoundingClientRect();

      // Ajustar a coords relativas al juego
      const gameRect = game.getBoundingClientRect();
      const foodBox = {
        left: foodRect.left - gameRect.left,
        right: foodRect.right - gameRect.left,
        top: foodRect.top - gameRect.top,
        bottom: foodRect.bottom - gameRect.top
      };
      const cloudBox = {
        left: cloudRect.left - gameRect.left,
        right: cloudRect.right - gameRect.left,
        top: cloudRect.top - gameRect.top,
        bottom: cloudRect.bottom - gameRect.top
      };

      if (!(foodBox.right < cloudBox.left ||
            foodBox.left > cloudBox.right ||
            foodBox.bottom < cloudBox.top ||
            foodBox.top > cloudBox.bottom)) {
        // Comida recogida
        foodCount++;
        info.textContent = `Comidas recolectadas: ${foodCount}`;

        // Aumentar tama√±o nube
        cloudSize += 4;
        if (cloudSize > cloudMaxSize) cloudSize = cloudMaxSize;
        cloud.style.fontSize = cloudSize + 'px';

        // Remover comida
        game.removeChild(f.el);
        foods.splice(i,1);
      }
    }
  }

  // Mover nube seg√∫n tiltX (giroscopio) o teclado
  function moveCloud() {
    // Velocidad de movimiento, multiplicar el tilt para mayor sensibilidad
    const speed = 6;
    cloudX += tiltX * speed;

    if (cloudX < cloudSize / 2) cloudX = cloudSize / 2;
    if (cloudX > gameWidth - cloudSize / 2) cloudX = gameWidth - cloudSize / 2;

    cloud.style.left = cloudX + 'px';
  }

  // Giroscopio
  function handleOrientation(event) {
    // gamma: rotaci√≥n izquierda/derecha [-90, 90]
    tiltX = event.gamma ? event.gamma / 30 : 0;
  }

  // Fallback teclado
  let leftPressed = false;
  let rightPressed = false;
  window.addEventListener('keydown', e => {
    if(e.key === 'ArrowLeft') leftPressed = true;
    if(e.key === 'ArrowRight') rightPressed = true;
  });
  window.addEventListener('keyup', e => {
    if(e.key === 'ArrowLeft') leftPressed = false;
    if(e.key === 'ArrowRight') rightPressed = false;
  });

  function updateTiltFromKeys() {
    if (leftPressed) tiltX = -1;
    else if (rightPressed) tiltX = 1;
    else tiltX = 0;
  }

  // L√≥gica de final de juego
  function endGame() {
    gameActive = false;
    train.style.display = 'block';

    // Comparar tama√±o nube vs tren
    // Tren tama√±o fijo 48px
    if (cloudSize > 48) {
      alert(`¬°Ganaste! Tu nube es m√°s grande que el tren.\nComidas recolectadas: ${foodCount}`);
    } else {
      alert(`Perdiste... El tren es m√°s grande que tu nube.\nComidas recolectadas: ${foodCount}`);
    }
    location.reload();
  }

  // Loop principal
  let frame = 0;
  function loop() {
    if (!gameActive) return;

    updateTiltFromKeys();
    moveCloud();

    // Crear comida cada 60 frames (~1 segundo a 60fps)
    if (frame % 60 === 0) {
      createFood();
    }

    moveFoods();

    frame++;
    requestAnimationFrame(loop);
  }

  // Iniciar juego y temporizador para pelea (40s)
  window.addEventListener('deviceorientation', handleOrientation);

  setTimeout(endGame, 40000);

  loop();
})();
</script>

</body>
</html>

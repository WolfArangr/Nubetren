<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>RPG - Repelente de Dragones</title>
  <style>
    body {
      background: radial-gradient(circle at center, #1a1a1a 0%, #000033 100%);
      font-family: 'Courier New', Courier, monospace;
      color: #00ffcc;
      text-shadow: 0 0 5px #00ffcc;
    }
    #text {
      background-color: #111;
      color: #00ffcc;
      padding: 10px;
      border: 2px solid #00ffcc;
      margin-top: 10px;
      white-space: pre-line;
    }
    #game {
      max-width: 600px;
      background: linear-gradient(#222, #111);
      margin: 20px auto;
      padding: 15px;
      border: 4px double #00ffcc;
      border-radius: 10px;
      box-shadow: 0 0 20px #00ffcc;
    }
    #controls button {
      background-color: #000;
      color: #00ffcc;
      border: 2px solid #00ffcc;
      padding: 10px;
      margin: 5px;
      cursor: pointer;
      font-weight: bold;
    }
    #controls button:hover {
      background-color: #00ffcc;
      color: #000;
    }
    #stats, #monsterStats {
      border: 2px solid #00ffcc;
      padding: 10px;
      margin-bottom: 10px;
      background-color: #111;
      color: #00ffcc;
    }
    .stat {
      display: inline-block;
      width: 32%;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="stats">
      <span class="stat">XP: <strong><span id="xpText">0</span></strong></span>
      <span class="stat">Salud: <strong><span id="healthText">100</span></strong></span>
      <span class="stat">Oro: <strong><span id="goldText">50</span></strong></span>
    </div>
    <div id="controls">
      <button id="button1">Ir a la tienda</button>
      <button id="button2">Entrar a la cueva</button>
      <button id="button3">Luchar al dragón</button>
    </div>
    <div id="monsterStats" style="display:none">
      <span class="stat">Enemigo: <strong><span id="monsterName"></span></strong></span>
      <span class="stat">Salud: <strong><span id="monsterHealth"></span></strong></span>
    </div>
    <div id="text">Bienvenido a Repelente de Dragones. Debes derrotar al dragón que impide a la gente salir del pueblo. Estás en la plaza. ¿Adónde quieres ir? Usa los botones de arriba.</div>
  </div>

  <script>
    let xp = 0, salud = 100, oro = 50, armaActual = 0, luchando, saludMonstruo;
    let inventario = ["palo"];
    const armas = [
      { name: "palo", power: 5 },
      { name: "daga", power: 30 },
      { name: "martillo", power: 50 },
      { name: "espada", power: 100 }
    ];
    const monstruos = [
      { name: "limo", level: 2, health: 15 },
      { name: "bestia colmuda", level: 8, health: 60 },
      { name: "dragón", level: 20, health: 300 }
    ];
    const ubicaciones = [
      {
        name: "plaza",
        "button text": ["Ir a tienda", "Entrar cueva", "Luchar dragón"],
        "button functions": [irTienda, irCueva, pelearDragon],
        text: 'Estás en la plaza del pueblo. Ves un cartel que dice "Tienda".'
      },
      {
        name: "tienda",
        "button text": ["Comprar +10 Salud (10 oro)", "Comprar arma (30 oro)", "Volver plaza"],
        "button functions": [comprarSalud, comprarArma, irPlaza],
        text: "Has entrado en la tienda."
      },
      {
        name: "cueva",
        "button text": ["Pelear limo", "Pelear bestia", "Volver plaza"],
        "button functions": [pelearLimo, pelearBestia, irPlaza],
        text: "Entras en la cueva. Ves algunos monstruos."
      },
      {
        name: "pelea",
        "button text": ["Atacar", "Esquivar", "Huir"],
        "button functions": [atacar, esquivar, irPlaza],
        text: "Estás luchando contra un monstruo."
      },
      {
        name: "victoria",
        "button text": ["Volver plaza", "Volver plaza", "Volver plaza"],
        "button functions": [irPlaza, irPlaza, huevoDePascua],
        text: 'El monstruo grita "¡Arg!" al morir. Ganas experiencia y encuentras oro.'
      },
      {
        name: "derrota",
        "button text": ["REJUGAR?", "REJUGAR?", "REJUGAR?"],
        "button functions": [reiniciar, reiniciar, reiniciar],
        text: "Has muerto. ☠️"
      },
      {
        name: "gana",
        "button text": ["REJUGAR?", "REJUGAR?", "REJUGAR?"],
        "button functions": [reiniciar, reiniciar, reiniciar],
        text: "¡Derrotas al dragón! ¡GANAS EL JUEGO! 🎉"
      },
      {
        name: "huevoDePascua",
        "button text": ["2", "8", "Volver plaza"],
        "button functions": [eligeDos, eligeOcho, irPlaza],
        text: "Encuentras un juego secreto. Elige un número..."
      }
    ];

    // Elementos del DOM
    const btn1 = document.querySelector("#button1"),
          btn2 = document.querySelector("#button2"),
          btn3 = document.querySelector("#button3"),
          txt = document.querySelector("#text"),
          xpTxt = document.querySelector("#xpText"),
          saludTxt = document.querySelector("#healthText"),
          oroTxt = document.querySelector("#goldText"),
          statsMon = document.querySelector("#monsterStats"),
          nombreMon = document.querySelector("#monsterName"),
          saludMonTxt = document.querySelector("#monsterHealth");

    // Eventos iniciales
    btn1.onclick = irTienda;
    btn2.onclick = irCueva;
    btn3.onclick = pelearDragon;

    function actualizar(loc) {
      statsMon.style.display = "none";
      [btn1.innerText, btn2.innerText, btn3.innerText] = loc["button text"];
      [btn1.onclick, btn2.onclick, btn3.onclick] = loc["button functions"];
      txt.innerText = loc.text;
    }
    function irPlaza() { actualizar(ubicaciones[0]); }
    function irTienda() { actualizar(ubicaciones[1]); }
    function irCueva() { actualizar(ubicaciones[2]); }
    function comprarSalud() {
      if (oro >= 10) { oro -= 10; salud += 10; oroTxt.innerText = oro; saludTxt.innerText = salud; }
      else txt.innerText = "¡No tienes suficiente oro!";
    }
    function comprarArma() {
      if (armaActual < armas.length-1) {
        if (oro >= 30) {
          oro -= 30;
          armaActual++;
          const arma = armas[armaActual].name;
          inventario.push(arma);
          txt.innerText = `Ahora tienes una ${arma}. En tu inventario: ${inventario.join(", ")}`;
          oroTxt.innerText = oro;
        } else txt.innerText = "No tienes suficiente oro para comprar un arma.";
      } else {
        txt.innerText = "¡Ya tienes el arma más poderosa!";
        btn2.innerText = "Vender arma por 15 oro";
        btn2.onclick = venderArma;
      }
    }
    function venderArma() {
      if (inventario.length > 1) {
        const vendida = inventario.shift();
        oro += 15;
        txt.innerText = `Vendiste un ${vendida}. Inventario: ${inventario.join(", ")}`;
        oroTxt.innerText = oro;
      } else txt.innerText = "¡No vendas tu única arma!";
    }
    function pelearLimo() { pelearCon(0); }
    function pelearBestia() { pelearCon(1); }
    function pelearDragon() { pelearCon(2); }
    function pelearCon(i) {
      luchando = i;
      actualizar(ubicaciones[3]);
      saludMonstruo = monstruos[i].health;
      statsMon.style.display = "block";
      nombreMon.innerText = monstruos[i].name;
      saludMonTxt.innerText = saludMonstruo;
    }
    function atacar() {
      txt.innerText = `El ${monstruos[luchando].name} ataca.\nAtacas con tu ${armas[armaActual].name}.`;
      if (Math.random() > .2 || salud < 20) salud -= ataquesMonstruo(monstruos[luchando].level);
      else txt.innerText += "\n¡Fallaste!";
      saludMonstruo -= armas[armaActual].power + Math.floor(Math.random()*xp) + 1;
      saludTxt.innerText = salud;
      saludMonTxt.innerText = saludMonstruo;
      if (salud <= 0) derrota();
      else if (saludMonstruo <= 0)
        luchando === 2 ? victoriaFinal() : victoria();
      if (Math.random() <= .1 && inventario.length > 1) {
        const roto = inventario.pop();
        txt.innerText += `\nTu ${roto} se rompe.`;
        armaActual--;
      }
    }
    function ataquesMonstruo(nivel) {
      return (nivel * 5) - Math.floor(Math.random() * xp);
    }
    function esquivar() {
      txt.innerText = `Esquivas el ataque del ${monstruos[luchando].name}.`;
    }
    function victoria() {
      oro += Math.floor(monstruos[luchando].level * 6.7);
      xp += monstruos[luchando].level;
      oroTxt.innerText = oro;
      xpTxt.innerText = xp;
      actualizar(ubicaciones[4]);
    }
    function derrota() { actualizar(ubicaciones[5]); }
    function victoriaFinal() { actualizar(ubicaciones[6]); }
    function reiniciar() {
      xp = 0; salud = 100; oro = 50; armaActual = 0;
      inventario = ["palo"];
      oroTxt.innerText = oro;
      saludTxt.innerText = salud;
      xpTxt.innerText = xp;
      irPlaza();
    }
    function huevoDePascua() { actualizar(ubicaciones[7]); }
    function eligeDos() { elegir(2); }
    function eligeOcho() { elegir(8); }
    function elegir(guess) {
      const nums = Array.from({length:10},()=>Math.floor(Math.random()*11));
      txt.innerText = `Elegiste ${guess}.\nNúmeros: ${nums.join(", ")}`;
      if (nums.includes(guess)) {
        oro += 20;
        oroTxt.innerText = oro;
        txt.innerText += "\n¡Acertaste! Ganas 20 oro.";
      } else {
        salud -= 10;
        saludTxt.innerText = salud;
        txt.innerText += "\n¡Fallaste! Pierdes 10 salud.";
        if (salud <= 0) derrota();
      }
    }
  </script>
</body>
</html>
